<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vedic Maths Webinar</title>

  <!-- CSS styles -->
  <link rel="stylesheet" href="/CSS/index.css">
  <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ✅ ADDED (ONLY CSS FOR STATE DROPDOWN) -->
  <style>
    .state-container {
      position: relative;
    }

    .state-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 9999;
    }

    .state-option {
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
    }

    .state-option:hover {
      background-color: #f2f2f2;
    }
  </style>
</head>

<body>

  <div class="main">
    <div class="header" style="display: flex; justify-content: center; margin: 0px 0px;">
      <img style="width: 170px;" src="assets/Untitled-2.png" alt="logo">
    </div>

    <!-- hero section -->
    <div id="hero-section">
      <h2 class="hero-h2">3-Days Free Vedic Maths Webinar by Sakal</h2>
      <div class="hero-img">
        <img
          src="https://d3jt6ku4g6z5l8.cloudfront.net/IMAGE/673c941b7b4ac10beb8a8360/8579754_dfhjkl.png"
          alt="Webinar Promo Image">
      </div>
    </div>

    <div id="form-div">
      <form action="" method="POST" id="form">
        <div id="user-section">

          <div class="form-group">
            <label class="label-rq" for="name">Full Name</label>
            <input type="text" id="name" placeholder="Full Name" required>
          </div>

          <div class="form-group">
            <label class="label-rq" for="wanumber">Phone Number</label>
            <input type="tel" id="wanumber" placeholder="Enter your WhatsApp number" required>
          </div>

          <div class="form-group">
            <label for="email">Your Email Address</label>
            <input type="email" id="email" placeholder="Email">
          </div>

          <div class="form-group">
            <label class="label-rq" for="reason">School Name</label>
            <textarea id="reason" placeholder="Enter The School Name" required></textarea>
          </div>

          <div class="form-group">
            <label class="label-rq" for="schoolArea">School Area</label>
            <input type="text" id="schoolArea" placeholder="Enter Your School Area" required>
          </div>

          <div class="form-group">
            <label class="label-rq" for="className">Class</label>
            <input type="text" id="className" placeholder="Class" required>
          </div>

          <div class="form-group">
            <label class="label-rq" for="city">City</label>
            <input type="text" id="city" placeholder="Enter Your City Name" required>
          </div>

        </div>
          <div class="form-group">
            <label class="label-rq" for="State">State</label>
            <div class="state-container">
              <input type="text" id="State" placeholder="Search State..." autocomplete="off" required>
              <div id="stateDropdown" class="state-dropdown"></div>
            </div>
          </div>



        <button type="button" id="submitBtn" onclick="submitForm()">Register for Webinar</button>
      </form>
    </div>

    <script>
      const SUPABASE_URL = "https://gcpvdftmhhkhqydtinii.supabase.co";
      const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjcHZkZnRtaGhraHF5ZHRpbmlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTg3MTUsImV4cCI6MjA3MzU3NDcxNX0.58fy1KkigNOGogw7fM_Oycd06AuA-EP2psbtxV_Dvg0";
      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const indianStates = [
        "Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat",
        "Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh",
        "Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab",
        "Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh",
        "Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh",
        "Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir",
        "Ladakh","Lakshadweep","Puducherry"
      ];

      /* ✅ ADDED — ONLY STATE SEARCH LOGIC */
      const stateInput = document.getElementById("State");
      const stateDropdown = document.getElementById("stateDropdown");

      stateInput.addEventListener("input", function () {
        const value = this.value.toLowerCase();
        stateDropdown.innerHTML = "";

        const filteredStates = indianStates.filter(s =>
          s.toLowerCase().includes(value)
        );

        if (!filteredStates.length) {
          stateDropdown.style.display = "none";
          return;
        }

        filteredStates.forEach(state => {
          const div = document.createElement("div");
          div.className = "state-option";
          div.textContent = state;
          div.onclick = () => {
            stateInput.value = state;
            stateDropdown.style.display = "none";
          };
          stateDropdown.appendChild(div);
        });

        stateDropdown.style.display = "block";
      });

      document.addEventListener("click", function (e) {
        if (!e.target.closest(".state-container")) {
          stateDropdown.style.display = "none";
        }
      });
      /* ✅ END ADDITION */

      async function submitForm() {
        // Get form values
        const phone = document.getElementById('wanumber').value;
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const school = document.getElementById('reason').value;
        const schoolArea = document.getElementById('schoolArea').value;
        const className = document.getElementById('className').value;
        const State = document.getElementById('State').value;
        const city = document.getElementById('city').value;

        const cleanPhone = phone.replace(/\D/g, '');
        if (cleanPhone.length !== 10) {
          alert('Please enter a valid 10-digit phone number');
          return false;
        }

        const formData = {
          fullName: name,
          phoneNumber: phone,
          email: email,
          schoolName: school,
          schoolArea: schoolArea,
          class: className,
          State: State,
          city: city
        };

        const scriptUrl = 'https://script.google.com/macros/s/AKfycby7fgZk0D648muKwJwP2s5FDyJn7vjVg9wHbE3TNlwlNaORh3qLygwv7ZO2Ms1HNnUt/exec';

        const aiSensyData = {
          apiKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3M2M5NDFiN2I0YWMxMGJlYjhhODM2MCIsIm5hbWUiOiJERU1PIDE5dGggTm92IiwiYXBwTmFtZSI6IkFpU2Vuc3kiLCJjbGllbnRJZCI6IjY3MmRhNDQ1ZTU4N2NkMGJlZDcxZTM1MyIsImFjdGl2ZVBsYW4iOiJQUk9fTU9OVEhMWSIsImlhdCI6MTczODQwNTgyNX0.-cfSHxvF-ReV8TGNX3M65RTKo4vcpvcH9jNjSA1B8Bo",
          campaignName: "11janv22",
          destination: `91${cleanPhone}`,
          userName: name,
          templateParams: [],
          source: "new-landing-page form",
          media: {
            url: "https://d3jt6ku4g6z5l8.cloudfront.net/IMAGE/673c941b7b4ac10beb8a8360/8862500_PHOTO20250206153940.jpg",
            filename: "sample_media"
          },
          buttons: [],
          carouselCards: [],
          location: {},
          attributes: {},
          paramsFallbackValue: {}
        };

        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';

        try {
          await fetch('https://backend.aisensy.com/campaign/t1/api/v2', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(aiSensyData)
          });

          await fetch(scriptUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          let redirectTo = "https://chat.whatsapp.com/FxasZlO0GD1FFOUnN3PvMv";
          const { data, error } = await supabaseClient
            .from('settings')
            .select('group_link')
            .order('id', { ascending: false })
            .limit(1);

          if (!error && data && data.length > 0 && data[0].group_link) {
            redirectTo = data[0].group_link;
          }

          window.location.href = redirectTo;

        } catch (err) {
          console.error('Error:', err);
          alert('Failed to send message. Please try again.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Register for Webinar';
        }
      }
    </script>

  </div>
</body>
</html>



